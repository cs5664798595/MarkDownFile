---
![人脸特征点检测方法分类](E:\markdown\images\人脸特征点检测方法分类.png)
---

## 从传统方法到深度学习，人脸关键点检测方法综述

>  人脸关键点检测是人脸识别和分析领域中的关键一步,是诸如自动人脸识别、表情分析、三维人脸重建及三维动画等其它人脸相关问题的前提和突破口。

#### **关键词：** 人脸关键点；人脸特征点；人脸对齐；卷积神经网络

一、引言

二、人脸关键点检测方法

2.1 ASM (Active Shape Models)

2.2 AAM（Active Appearance Models）

2.3 CPR（Cascaded pose regression）

2.4 DCNN

2.5 Face++版 DCNN

2.6 TCDCN

2.7 MTCNN

2.8 TCNN（Tweaked Convolutional Neural Networks）

2.9 DAN（Deep Alignment Networks）

三、结语

参考文献



### 一、整体概况

​       人脸关键点检测也称为人脸关键点检测、定位或者人脸对齐，是指给定人脸图像，定位出人脸面部的关键区域位置，包括眉毛、眼睛、鼻子、嘴巴、脸部轮廓等和人脸检测类似。由于受到姿态和遮挡等因素的影响，人脸关键点检测也是一个富有挑战性的任务。

>  人脸关键点检测方法分类：

![人脸特征点检测方法分类](E:\markdown\images\人脸特征点检测方法分类.png)




(1) . 根据发展历程大致分为三种，分别是

* 基 于参数模型ASM(Active Shape Model)[1] 和 AAM (Active Appearnce Model)[2,3] 的传统方法；

* 基于级联形状回归的方法 [4]；

* 基于深度学习的方法 [5-10]。

(2). 若是按照参数化与否来分，可分为参数化方法和非参数化方法，

* ASM、AAM 和 CLM[11] 就属于参数化方法，可依据其外观模型的不同，可进一步分为
  * 基于局部的方法 [12-14] 
  * 基于全局的方法 [15-17]
* 而级联回归和深度学习方法属于非参数化方法。可分为
  * 基于样例的方法 [18,19]
  * 基于图模型的方法 [20,21]
  * 基于级联回归的方法 [4,22,23] 
  * 基于深度学习的方法 [24-26]

目前，应用最广泛，效果精度最高的是基于深度学习的方法。

>  人脸关键点定位方法中具有里程碑式的有如下五种方法：

1) 1995 年，Cootes 的 ASM(Active Shape Model)。

2) 1998 年，Cootes 的 AAM(Active Appearance Model) 算法。

3) 2006 年，Ristinacce 的 CLM（Constrained Local Model）算法。

4) 2010 年，Rollar 的 cascaded Regression 算法。

5) 2013 年，Sun 开创深度学习人脸关键点检测的先河，首次将 CNN 应用到人脸关键点定位上。

> 评价比较标准

定量评价方面，目前主要的衡量标准是算法所获取的关键点位置与真实关键点位置之间的偏差。在评价偏差时，由于不同人脸图像的实际大小难免会有所差异，为便于在同样的尺度下比较算法性能，需要采用一定的数据归一化策略． 目前主流的方法是基于两眼间的距离进行人脸大小的标准化，即：

![img](http://img003.21cnimg.com/photos/album/20171217/s366x152/40AF5FD7CCEBBBD55E4DCAF1C90CF57D.webp)

，其中分子![img](http://img003.21cnimg.com/photos/album/20171217/s260x76/C4A2A1C0A65CEAB73F18039DA4985D65.webp)表示估计值与真实值的欧式距离，分母![img](http://img001.21cnimg.com/photos/album/20171217/s120x46/38C05F7122AA7364D716AA8C8C69C522.webp)表示双眼距离，即两眼中心的欧式距离。也有采用边界框对角线作为归一化因子来评价偏差，如文献 [20]。

>  所选用的数据库

传统人脸关键点检测数据库为室内环境下采集的数据库。

* 比如 Multi-pie、Feret、Frgc、AR、BioID 等人脸数据库。

而现阶段人脸关键点检测数据库通常为复杂环境下采集的数据库．

* LFPW 人脸数据库有 1132 幅训练人脸图像和 300 幅测试人脸图像，大部分为正面人脸图像，每个人脸标定 29 个关键点。
* AFLW 人脸数据库包含 25993 幅从 Flickr 采集的人脸图像，每个人脸标定 21 个关键点。
* COFW 人脸数据库包含 LFPW 人脸数据库训练集中的 845 幅人脸图像以及其他 500 幅遮挡人脸图像，而测试集为 507 幅严重遮挡（同时包含姿态和表情的变化）的人脸图像，每个人脸标定 29 个关键点。
* MVFW 人脸数据库为多视角人脸数据集，包括 2050 幅训练人脸图像和 450 幅测试人脸图像，每个人脸标定 68 个关键点。
* OCFW 人脸数据库包含 2951 幅训练人脸图像（均为未遮挡人脸）和 1246 幅测试人脸图像（均为遮挡人脸），每个人脸标定 68 个关键点。

![img](http://img003.21cnimg.com/photos/album/20171217/s984x816/B80D0884FECFBDBFE83CA6D6B5C116F6.webp)

 

## 二、典型检测方法介绍

1. **ASM (Active Shape Models)**

主动形状模型即通过**形状模型**对目标物体进行抽象，ASM 是一种基于**点分布模型（Point Distribution Model, PDM）**的算法。在 PDM 中，外形相似的物体，例如人脸、人手、心脏、肺部等的几何形状可以通过若干关键点（landmarks）的坐标依次串联形成一个**形状向量**来表示。ASM 算法需要通过**人工标定**的方法先标定训练集，经过训练获得形状模型，再通过关键点的匹配实现特定物体的匹配。

ASM 主要分为两步：

  **搜集N个训练样本**：

​                 搜集的图片只要有人脸的面部区域就可以了，暂时不需要考虑尺寸的归一化问题。以便完成人脸区域的ASM训练。

   **手动记录每个样本中的k个关键点**：

​                  对于训练集中的一个图片而言，你需要手动标记下（68）个关键点的位置坐标信息，并且将它们保存在文本中。最好用程序实现半自动化标定。

  **构建训练集的形状向量**：

​                 将一幅图片中的K个关键点组成一个形状向量 *X*( *Xi,Y* ), 其中，Xi 为 i 个位置坐标组成的向量，这样所有N个图像便生成N个训练样本，构成了N个形状向量组成的集合S(X |*X*(*Xi,Y* ) ,N )。

 **形状归一化**：

​                 改步骤的目的在于对前面手动标定的人脸形状进行归一化或者对齐操作，从而消除图片中人脸由于不同角度、距离远近、姿态变换等外界因素造成的非形状干扰，从而使点分布模型更加有效。 一般，使用Procrusts方法进行归一化：把一系列的点分布模型通过适当的平移、旋转和缩放变换，在不改变点分布模型的基础上对齐到一个点分布模型，从而改变原始的 非形状干扰。

​                 Procrusts归一化方法一般为使用一个四元数：旋转角度a, 缩放尺度s，水平位移x, 垂直位移y 。可以用一个 4X4 的矩阵来完成转换过程。

​                 在ASM模型中，利用Procrusts转换 完成 点分布模型的对齐操作，具体过程为：

​                            （1）、将训练集中的所有人脸模型对齐到第一个人脸模型（典型意义，可以自主选择）；

​                            （2）、计算平均人脸模型 X0,

​                            （3）、将所有人脸模型对齐到平均人脸 X0,

​                            （4）、重复（2）（3），直至X0收敛或者到一定时间停止。

![ASM建立形状模型示意图](E:\markdown\images\ASM建立形状模型示意图.png)

**选择是否PCA：**

​                     若考虑到某些特征的影响可以忽略，可以考虑PCA，只选取主要特征项。

衡量2个形状之间的距离
$$
D=SUM(|X_i-X_{avg}|^2)
$$




* 第一步：训练。首先，构建形状模型：搜集 n 个训练样本（n=400）；手动标记脸部关键点；将训练集中关键点的坐标串成特征向量；

  选择合适的特征点

  特征点的选取很重要。好的特征点大概应该或多或少满足如下几点：边缘点、曲率大的、T型连接点和以上这些点的连线上的等分点。

  ![ASM特征点图解](E:\markdown\images\ASM特征点图解.jpg)

  

  

  这张图中有67个标定点，需要注意的是各个标定点的顺序在训练集中的各张照片需要一致。比如`2`和`12`这两点分别对应脸和耳朵的连接处，在其他的训练图像中也要有一样的标定点。 
  假设我们一共有`N`张的训练图，每一张图都有`n`个点，第`i`张图像的第`k`点坐标表示为 

  $$
  (xi,j,yi,j)(xi,j,yi,j)
  $$

  对于第i张图像，各个标定点可以用一个矩阵表示： 


$$
Xi=[x^i ,y<sub>i0</sub>,x<sub>i1</sub>,y<sub>i1</sub>,...x<sub>i(n−1)</sub>,y<sub>i(n−1)</sub>]^T
$$

  其中1<=i<=N<sub>22</sub>;x^2x2^

[^231]: 

$$

$$
wsewe>wqw
$$

$$
ee<^>42342</^>
$$



n<sup>2</sup>=n+1

  这也是asm方法的优点，得到的特征点是有序的。这样得到一组特征点集X

  ![ASM（active <wbr>shape <wbr>models）算法介绍](http://my.csdn.net/uploads/201204/17/1334631634_5908.jpg)

  我们这里把它看做是一个2n维的向量

  ![ASM（active <wbr>shape <wbr>models）算法介绍](http://my.csdn.net/uploads/201204/17/1334631698_9415.jpg)

  对形状进行归一化和对齐（对齐采用 Procrustes 方法）；对对齐后的形状特征做 PCA 处理。接着，为每个关键点构建局部特征。目的是在每次迭代搜索过程中每个关键点可以寻找新的位置。局部特征一般用梯度特征，以防光照变化。有的方法沿着边缘的法线方向提取，有的方法在关键点附近的矩形区域提取。

* 第二步：搜索。首先：计算眼睛（或者眼睛和嘴巴）的位置，做简单的尺度和旋转变化，对齐人脸；接着，在对齐后的各个点附近搜索，匹配每个局部关键点（常采用马氏距离），得到初步形状；再用平均人脸（形状模型）修正匹配结果；迭代直到收敛。

 ASM 算法的优点在于**模型简单直接**，架构清晰明确，易于理解和应用，而且对轮廓形状有着较强的约束，但是其近似于穷举搜索的关键点定位方式在一定程度上限制了其运算效率。

2. **AAM（Active Appearance Models）**

在ASM 的基础上，采用形状约束 + 加入整个脸部区域的纹理特征，提出了 AAM 算法 [2]。

AAM 于 ASM 一样，主要分为两个阶段，模型建立阶段和模型匹配阶段。其中模型建立阶段包括对训练样本分别建立形状模型 (Shape Model) 和纹理模型 (Texture Model)，然后将两个模型进行结合，形成 AAM 模型。

3. **CPR（Cascaded pose regression）**

Dollar 提出 CPR（Cascaded Pose Regression, 级联姿势回归）[4]，CPR 通过一系列回归器将一个指定的初始预测值逐步细化，每一个回归器都依靠前一个回归器的输出来执行简单的图像操作，整个系统可自动的从训练样本中学习。

人脸关键点检测的目的是估计向量

![img](http://img001.21cnimg.com/photos/album/20171217/s634x70/07FBC26A7C53301D8C7943359692D942.webp)

，其中 K 表示关键点的个数，由于每个关键点有横纵两个坐标，所以 S 得长度为 2K。CPR 检测流程如图所示，一共有 T 个阶段，在每个阶段中首先进行特征提取，得到![img](http://img001.21cnimg.com/photos/album/20171217/s40x48/13C608D84200105C4C2CE4B0C4F80762.webp), 这里使用的是 shape-indexed features，也可以使用诸如 HOG、SIFT 等人工设计的特征，或者其他可学习特征（learning based features），然后通过训练得到的回归器 R 来估计增量ΔS( update vector)，把ΔS 加到前一个阶段的 S 上得到新的 S，这样通过不断的迭代即可以得到最终的 S(shape)。